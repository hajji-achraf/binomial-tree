<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modèle Binomial - OptionPricer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
    <script src="https://cdn.plot.ly/plotly-2.14.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                <div class="logo-container">
                    <span class="logo-text">HA</span>
                </div>
                <span class="brand-text">OptionPricer</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" id="modelsDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-calculator me-1"></i> Modèles
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/black-scholes">Black-Scholes</a></li>
                            <li><a class="dropdown-item active" href="/binomial">Binomial</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/convergence">
                            <i class="fas fa-chart-line me-1"></i> Convergence
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/exercise-boundary">
                            <i class="fas fa-border-all me-1"></i> Frontière d'exercice
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header with Model Description -->
    <section class="model-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="model-title">
                        <div class="model-icon"><i class="fas fa-project-diagram"></i></div>
                        Modèle Binomial
                    </h1>
                    <p class="model-description">
                        Le modèle binomial est une méthode numérique basée sur la discrétisation du temps et du prix, permettant de valoriser 
                        les options européennes et américaines. Il est particulièrement adapté pour visualiser l'évolution du prix et de la valeur de l'option.
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="formula-box">
                        <span id="binomial-formula"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="row">
            <!-- Input Parameters Card -->
            <div class="col-md-4">
                <div class="parameters-card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-sliders-h me-2"></i>Paramètres d'entrée</h4>
                    </div>
                    <div class="card-body">
                        <form id="binomial-form">
                            <!-- Type d'option -->
                            <div class="mb-3">
                                <label class="form-label">Type d'option</label>
                                <div class="option-type-selector">
                                    <div class="type-option">
                                        <input class="form-check-input" type="radio" name="optionType" id="call" checked>
                                        <label class="form-check-label" for="call">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>Call</span>
                                        </label>
                                    </div>
                                    <div class="type-option">
                                        <input class="form-check-input" type="radio" name="optionType" id="put">
                                        <label class="form-check-label" for="put">
                                            <i class="fas fa-arrow-down"></i>
                                            <span>Put</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Style d'option -->
                            <div class="mb-3">
                                <label class="form-label">Style d'option</label>
                                <div class="option-type-selector">
                                    <div class="type-option">
                                        <input class="form-check-input" type="radio" name="optionStyle" id="european" checked>
                                        <label class="form-check-label" for="european">
                                            <i class="fas fa-flag-checkered"></i>
                                            <span>Européenne</span>
                                        </label>
                                    </div>
                                    <div class="type-option">
                                        <input class="form-check-input" type="radio" name="optionStyle" id="american">
                                        <label class="form-check-label" for="american">
                                            <i class="fas fa-calendar-alt"></i>
                                            <span>Américaine</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Prix spot -->
                            <div class="mb-3">
                                <label for="spot-price" class="form-label">Prix spot (S₀)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="spot-price" min="0.01" step="0.01" value="100">
                                    <span class="input-group-text"><i class="fas fa-euro-sign"></i></span>
                                </div>
                            </div>
                            
                            <!-- Prix d'exercice -->
                            <div class="mb-3">
                                <label for="strike-price" class="form-label">Prix d'exercice (K)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="strike-price" min="0.01" step="0.01" value="100">
                                    <span class="input-group-text"><i class="fas fa-euro-sign"></i></span>
                                </div>
                            </div>
                            
                            <!-- Maturité -->
                            <div class="mb-3">
                                <label for="time-to-maturity" class="form-label">Maturité (T)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="time-to-maturity" min="0.01" step="0.01" value="1">
                                    <span class="input-group-text">années</span>
                                </div>
                            </div>
                            
                            <!-- Taux sans risque -->
                            <div class="mb-3">
                                <label for="risk-free-rate" class="form-label">Taux sans risque (r)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="risk-free-rate" min="0" step="0.1" value="5">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            
                            <!-- Volatilité -->
                            <div class="mb-3">
                                <label for="volatility" class="form-label">Volatilité (σ)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="volatility" min="0.1" step="0.1" value="20">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            
                            <!-- Nombre d'étapes -->
                            <div class="mb-3">
                                <label for="steps" class="form-label">Nombre d'étapes</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="steps" min="1" max="10" value="3">
                                    <button type="button" class="btn btn-outline-primary" id="decrease-steps">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="increase-steps">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="form-text">Pour la visualisation de l'arbre, limitez à 10 étapes maximum</div>
                            </div>
                            
                            <!-- Bouton de calcul -->
                            <div class="d-grid">
                                <button type="submit" id="calculate-btn" class="btn btn-primary">
                                    <i class="fas fa-calculator me-2"></i>Calculer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Results and Tree Visualization -->
            <div class="col-md-8">
                <!-- Results Card -->
                <div class="results-card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4><i class="fas fa-chart-bar me-2"></i>Résultats</h4>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" id="export-results">
                                <i class="fas fa-download me-1"></i>Exporter
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Price Display -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <div class="price-card">
                                    <div class="price-label">Prix de l'option</div>
                                    <div class="price-value" id="option-price">--</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tree Parameters -->
                        <div class="row mb-3">
                            <div class="col-md-4 mb-2">
                                <div class="tree-param-box">
                                    <div class="param-label">u (facteur de hausse)</div>
                                    <div class="param-value" id="u-factor">--</div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <div class="tree-param-box">
                                    <div class="param-label">d (facteur de baisse)</div>
                                    <div class="param-value" id="d-factor">--</div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <div class="tree-param-box">
                                    <div class="param-label">p (probabilité)</div>
                                    <div class="param-value" id="p-prob">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tree Visualization Card -->
                <div class="tree-card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-project-diagram me-2"></i>Arbre Binomial</h4>
                    </div>
                    <div class="card-body">
                        <div class="tree-controls mb-3">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-primary active" id="view-price-tree">
                                    Prix de l'actif
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="view-option-tree">
                                    Valeur de l'option
                                </button>
                            </div>
                            <div class="tree-zoom-controls">
                                <button class="btn btn-sm btn-outline-secondary" id="zoom-in">
                                    <i class="fas fa-search-plus"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" id="zoom-out">
                                    <i class="fas fa-search-minus"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" id="zoom-reset">
                                    <i class="fas fa-undo"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="tree-container" id="binomial-tree-container">
                            <!-- L'arbre sera généré ici par D3.js -->
                        </div>
                        
                        <div class="tree-legend mt-3">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #4CAF50;"></div>
                                <div class="legend-label">Prix actifs</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #2196F3;"></div>
                                <div class="legend-label">Valeur option</div>
                            </div>
                            <div class="legend-item american-only" style="display: none;">
                                <div class="legend-color" style="background-color: #FF9800;"></div>
                                <div class="legend-label">Exercice anticipé</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Formules et Explications -->
        <div class="row">
            <div class="col-12">
                <div class="theory-card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-book me-2"></i>Formules et Explications</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Paramètres du modèle binomial</h5>
                                <div class="formula-container mb-4">
                                    <div id="binomial-u-formula"></div>
                                    <div id="binomial-d-formula" class="mt-2"></div>
                                    <div id="binomial-p-formula" class="mt-2"></div>
                                </div>
                                
                                <h5>Évaluation récursive</h5>
                                <div class="formula-container">
                                    <div id="binomial-recursive-formula"></div>
                                    <p class="mt-2">Pour les options américaines, à chaque nœud, on prend le maximum entre la valeur de continuation et la valeur d'exercice immédiat.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Méthode binomiale et valorisation d'options</h5>
                                <p>Le modèle binomial est basé sur la discrétisation du temps et du mouvement du prix. À chaque étape, le prix peut monter (avec probabilité p) ou descendre (avec probabilité 1-p). Cela permet de créer un arbre où chaque nœud représente un état possible du prix à un instant donné.</p>
                                
                                <h6 class="mt-3">Propriétés clés :</h6>
                                <ul>
                                    <li>Valorisation d'options européennes et américaines</li>
                                    <li>Convergence vers la solution Black-Scholes quand le nombre d'étapes augmente</li>
                                    <li>Capacité à modéliser l'exercice anticipé pour les options américaines</li>
                                    <li>Visualisation de l'évolution du prix et de la valeur de l'option</li>
                                </ul>
                                
                                <h6 class="mt-3">Processus d'évaluation :</h6>
                                <ol>
                                    <li>Construire l'arbre des prix jusqu'à maturité</li>
                                    <li>Calculer les payoffs à maturité</li>
                                    <li>Remonter l'arbre par induction rétrograde</li>
                                    <li>À chaque nœud, calculer la valeur de l'option par actualisation des valeurs futures espérées</li>
                                    <li>Pour les options américaines, comparer avec la valeur d'exercice immédiat</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/binomial.js') }}"></script>
</body>
</html>